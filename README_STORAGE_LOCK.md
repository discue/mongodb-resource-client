<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

## ConstructorOptions

### Properties

*   `client` **MongoClient?** configured mongo client to use. Can be null if url is set
*   `databaseName` **[string][1]?** name of the mongodb database
*   `connectTimeout` **[number][2]?** the connect timeout of the mongo db client if client was not passed

### Examples

```javascript
const { ResourceLock } = require('@discue/mongodb-resource-client')

const url = 'mongodb://127.0.0.1:27017'
const lock = new ResourceLock({
  url
})

await lock.doWhileLocked([123], () => {
     // do important stuff while lock is being held for 5s by default
})
```

## ResourceLock

Creates lock documents and allows to execute functions with a lock.

## lock

Creates an entry in the `locks` collection. The context param is a unique identifier. If context already
exists, the method will throw.

### Parameters

*   `resourceIds` **[Array][3]<[string][1]>** the resource ids

## unlock

Deletes an entry from the `locks` collection unlocking the document.
The context param is a unique identifier. If context has already been
removed, the method will throw.

### Parameters

*   `resourceIds` **[Array][3]<[string][1]>** the resource ids

## doWhileLocked

Executes the callback only if the appropriate lock document has been created successfully.
Unlocks the document either after completion of the callback or after `lockTimeout` millis
have passed.

### Parameters

*   `resourceIds` **[Array][3]<[string][1]>** the resource ids
*   `callback` **[Function][4]** callback to execute with lock
*   `options` **[Object][5]**  (optional, default `{}`)

    *   `options.lockTimeout` **[Number][2]** max time to wait in milliseconds (optional, default `5_000`)
    *   `options.waitTimeout` **[Number][2]** max time to wait in milliseconds (optional, default `5_000`)
    *   `options.retryInterval` **[Number][2]** max time to wait in between retries (optional, default `125`)

<!---->

*   Throws **[Error][6]** Unable to establish lock - if unable to establish lock for a document
*   Throws **[Error][6]** Lock interrupted by timeout - if callback did not return before lockTimeout

## close

Closes the database client.

Returns **void**&#x20;

[1]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[2]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[3]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[4]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[5]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[6]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error
