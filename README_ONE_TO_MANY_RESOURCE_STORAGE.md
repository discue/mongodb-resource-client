<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

## ConstructorOptions

### Properties

*   `url` **[String][1]?** url to mongo instance. Can be null if client is set
*   `client` **MongoClient?** configured mongo client to use. Can be null if url is set
*   `databaseName` **[string][1]?** name of the mongodb database
*   `collectionName` **[string][1]** name of the mongodb collection used to store the resources
*   `resourceName` **[string][1]** name of the resource e.g. users, customers, topics, shipments
*   `resourcePath` **[string][1]?** slash separated path describing the hierarchy e.g. universities/teachers/subjects/exams.
*   `hiddenResourcePath` **[string][1]?** slash separated path describing which path elements should not be returned to callers
*   `enableTwoWayReferences` **[string][1]** true if documents should also store references to their parents e.g. student have references to their schools

### Examples

```javascript
const { OneToManyResourceStorage } = require('@discue/mongodb-resource-client')
const oneToManyResourceStorage = new OneToManyResourceStorage({
  url: 'mongodb://127.0.0.1:27017',
  collectionName: 'api_clients',
  resourceName: 'listeners'
  enableTwoWayReferences: true
})
```

## OneToManyResourceStorage

Manages relationships between entities in a more decoupled way by keep storing
entities in separate collections and using references to establish an relationship
between both. This way students can be queried independently of an university,
while all studies of a university can still be looked up via the stored reference.

The references between both collections are kept up-to-date. Deleting a document,
causes the reference to be deleted in the other entity. Adding a document
causes a reference to be updated, too.

<strong>Students collection</strong>

```js
{
  id: 1828391,
  name: 'Miles Morales',
},
{
  id: 4451515,
  name: 'Bryan Jenkins',
}
```

<strong>Universities collection</strong>

```js
{
  name: 'University Munich',
  students: [1828391]
}
{
  name: 'University Stuttgart',
  students: [4451515]
}
```

## exists

Returns true if a resource with given ids exists.

### Parameters

*   `resourceIds` **([String][1] | [Array][2]<[String][1]>)**&#x20;

Returns **[boolean][3]**&#x20;

## get

Returns a resource by ids.

### Parameters

*   `resourceIds` **([String][1] | [Array][2]<[String][1]>)** resource ids that will added to the resource path i.e. /users/${id}/documents/${id}
*   `options` **GetOptions**&#x20;

Returns **[Object][4]**&#x20;

## getAll

Returns resources based on return value of [findReferences][5].

### Parameters

*   `resourceIds` **([String][1] | [Array][2]<[String][1]>)** resource ids that will added to the resource path i.e. /users/${id}/documents/${id}
*   `options` **GetOptions**&#x20;

## findReferences

Looks up references of current resource in parent and parent's parent collection based on given resourceIds.

Given `resourcePath=/countries/cities` and `resourceName=companies`

*   if `resourceIds` has value \[1,2,3], then the method returns \[\[1,2,3]]
*   if `resourceIds` has value \[1,2], then only references of companies in city with `id=2` will returned
*   if `resourceIds` has value \[1], then references of all companies of all cities of country with `id=1` will be returned

Meaning: The more ids are given, the more narrow the search is. Less ids make the search window more wide
and will lead to larger number of results.

### Parameters

*   `resourceIds` **([String][1] | [Array][2]<[String][1]>)** resource ids that will added to the resource path i.e. /users/${id}/documents/${id}
*   `verifyParentReference` **[Boolean][3]** true if we should check whether an id is actually referenced by its parent to prevent info leakage (optional, default `true`)

Returns **[Array][2]<[Array][2]<[String][1]>>** an array of resource ids

## create

Add a resource to a collection by ids.

### Parameters

*   `resourceIds` **([String][1] | [Array][2]<[String][1]>)** resource ids that will added to the resource path i.e. /users/${id}/documents/${id}
*   `resource` **[Object][4]** the resource to be stored

## update

Updates a resource by ids

### Parameters

*   `resourceIds` **([String][1] | [Array][2]<[String][1]>)** resource ids that will added to the resource path i.e. /users/${id}/documents/${id}
*   `update` **[Object][4]** values that should be updated

## delete

Deletes a resource by ids

### Parameters

*   `resourceIds` **([String][1] | [Array][2]<[String][1]>)** resource ids that will added to the resource path i.e. /users/${id}/documents/${id}

[1]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[2]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[3]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[4]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[5]: #findreferences
